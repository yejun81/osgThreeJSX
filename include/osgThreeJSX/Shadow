#pragma once
#include <osg/Referenced>
#include <vector>
#include <map>
#include <osg/Vec3>
#include <osg/Camera>
#include <osg/StateSet>
#include <osg/Uniform>
#include <unordered_map>
#include <osgThreeJSX/Export>
#include <osgThreeJSX/MaterialNode>
#include <osgThreeJSX/Programs>
#include <osgUtil/CullVisitor>
#include <osgUtil/UpdateVisitor>

namespace osgThreeJSX
{
	class RenderState;

	class OSGTHREEJSX_EXPORT ShadowMap : public osg::Object
	{
	public:
		//
		ShadowMap();
		//
		ShadowMap(const ShadowMap& other, const osg::CopyOp& copyop = osg::CopyOp::SHALLOW_COPY) {}
		//
		virtual ~ShadowMap() {}

		META_Object(osg, ShadowMap);
	public:
		//
		void setup(const osg::ref_ptr<osg::Node>& scene, ShadowMapType mapType = ShadowMapType_BasicShadowMap);
		//
		void onCull(RenderState* renderState, osgUtil::CullVisitor* cv);
	public:
		//
		void setEnable(bool flag) { _enable = flag; }
		//
		bool isEnable() { return _enable && _sceneNode.valid(); }
		//
		ShadowMapType getMapType() { return _mapType; }
	protected:
		ShadowMapType _mapType;
		bool _enable;
		osg::ref_ptr<osg::Node> _sceneNode;
	};
} 